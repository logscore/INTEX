<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Participants</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&display=swap" rel="stylesheet">
  <style>
    :root { --cream:#f9f5ea; --light-pink:#ffd8d1; --pink:#f9afb1; --gray:#3a3f3b; }
    body { background-color:var(--light-pink); font-family:Arial, sans-serif; margin:0; color:var(--gray); min-height:100vh; display:flex; flex-direction:column; }
    .navbar-brand{ font-weight:bold; display:flex; align-items:center; gap:6px; font-size:1.25rem; }
    .btn-white{ background:white; border:2px solid var(--gray); color:var(--gray)!important; transition:0.2s }
    .btn-white:hover{ background:var(--gray); color:white!important }
    .card{ border-radius:12px }
    .label{ font-weight:600; color:#444 }
    .page-wrapper{ padding:40px 20px; flex:1 }
    .footer{ background-color:black; color:white; height:100px; display:flex; justify-content:center; align-items:center; margin-top:40px }
    .footer-text{ font-family:'DM Serif Display', serif; font-size:1.5rem; display:flex; gap:10px; align-items:center }
    .copyright{ text-align:center; padding:8px 0 20px; font-size:0.9rem }
  </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-light bg-white shadow-sm px-4">
  <a class="navbar-brand" href="/">
    Ella
    <img src="/fulllogo.jpg" alt="Ella Rises Logo" style="width:35px; height:35px; object-fit: contain; vertical-align: text-bottom; margin-left: 8px;">
    Rises
  </a>

  <div>
    <a href="/userDashboard" class="btn btn-white btn-sm me-2">Back to Dashboard</a>
    <a href="/logout" class="btn btn-white btn-sm">Logout</a>
  </div>
</nav>

<div class="page-wrapper container">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="card p-4 mb-4">
        <h2>Participants</h2>
        <p class="text-muted">View participant information. Admins can view all participants with <code>?all=true</code>.</p>
      </div>

      <% if (typeof participants !== 'undefined' && participants && participants.length > 0) { %>
        <div class="card p-3 mb-4">
          <h4>All Participants</h4>
          <div class="table-responsive">
            <table class="table table-sm">
              <thead class="table-dark">
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>DOB</th>
                  <th>Role</th>
                  <th>Phone</th>
                  <th>City</th>
                  <th>State</th>
                  <th>Zip</th>
                  <th>School/Employer</th>
                  <th>Field</th>
                  <th>Donations</th>
                </tr>
              </thead>
              <tbody>
                <% participants.forEach(function(p) { %>
                  <tr>
                    <td><a href="/displayParticipants?id=<%= p.ParticipantID %>"><%= p.ParticipantFirstName %> <%= p.ParticipantLastName %></a></td>
                    <td><%= p.ParticipantEmail %></td>
                    <td><%= p.ParticipantDOB ? new Date(p.ParticipantDOB).toLocaleDateString() : '—' %></td>
                    <td><%= p.ParticipantRole || '—' %></td>
                    <td><%= p.ParticipantPhone || '—' %></td>
                    <td><%= p.ParticipantCity || '—' %></td>
                    <td><%= p.ParticipantState || '—' %></td>
                    <td><%= p.ParticipantZip || '—' %></td>
                    <td><%= p.ParticipantSchoolOrEmployer || '—' %></td>
                    <td><%= p.ParticipantFieldOfInterest || '—' %></td>
                    <td>$<%= p.TotalDonations !== null ? p.TotalDonations : '0.00' %></td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        </div>
      <% } else if (typeof participant !== 'undefined' && participant && participant.ParticipantID) { %>
        <div class="card p-4 mb-4">
          <h4><%= participant.ParticipantFirstName %> <%= participant.ParticipantLastName %> <small class="text-muted">(ID: <%= participant.ParticipantID %>)</small></h4>
          <div class="row mt-3">
            <div class="col-md-6">
              <p><span class="label">Email:</span> <%= participant.ParticipantEmail %></p>
              <p><span class="label">Phone:</span> <%= participant.ParticipantPhone || '—' %></p>
              <p><span class="label">DOB:</span> <%= participant.ParticipantDOB ? new Date(participant.ParticipantDOB).toLocaleDateString() : '—' %></p>
              <p><span class="label">Role:</span> <%= participant.ParticipantRole || '—' %></p>
            </div>
            <div class="col-md-6">
              <p><span class="label">City:</span> <%= participant.ParticipantCity || '—' %></p>
              <p><span class="label">State:</span> <%= participant.ParticipantState || '—' %></p>
              <p><span class="label">Zip:</span> <%= participant.ParticipantZip || '—' %></p>
            </div>
          </div>

          <hr />
          <p><span class="label">School / Employer:</span> <%= participant.ParticipantSchoolOrEmployer || '—' %></p>
          <p><span class="label">Field of Interest:</span> <%= participant.ParticipantFieldOfInterest || '—' %></p>
          <p><span class="label">Total Donations:</span> $<%= participant.TotalDonations !== null ? participant.TotalDonations : '0.00' %></p>
        </div>
      <% } else { %>
        <div class="alert alert-info">No participant information found for your account.</div>
      <% } %>

    </div>
  </div>
</div>

<!-- FOOTER -->
<div class="footer">
  <div class="footer-text">
    Ella
    <img src="/EllaRises.jpg" alt="Logo" style="width:30px; height:auto; vertical-align: middle;">
    Rises
  </div>
</div>

<p class="copyright">© 2025 Ella Rises. All Rights Reserved.</p>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function filterParticipants() {
      const input = document.getElementById('searchInput');
      const filter = input.value.toLowerCase();
      const rows = document.getElementsByClassName('participant-row');
      const cityGroups = document.getElementsByClassName('city-group');
      
      // Filter rows
      for (let i = 0; i < rows.length; i++) {
        const name = rows[i].getAttribute('data-name');
        if (name.indexOf(filter) > -1) {
          rows[i].style.display = '';
        } else {
          rows[i].style.display = 'none';
        }
      }
      
      // Show/hide city groups and auto-expand if searching
      for (let i = 0; i < cityGroups.length; i++) {
        const cityGroup = cityGroups[i];
        const visibleRows = Array.from(cityGroup.querySelectorAll('.participant-row')).filter(row => row.style.display !== 'none');
        
        if (visibleRows.length > 0) {
          cityGroup.style.display = '';
          
          // Auto-expand groups when searching
          if (filter.length > 0) {
            const collapseDiv = cityGroup.querySelector('.collapse');
            if (collapseDiv && !collapseDiv.classList.contains('show')) {
              const bsCollapse = new bootstrap.Collapse(collapseDiv, { toggle: true });
            }
          }
        } else {
          cityGroup.style.display = 'none';
        }
      }
    }
  </script>
</body>
</html>
